<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width,initial-scale=1.0,user-scalable=no">
    <title>哈哈</title>
    <style>
        *{
            padding: 0;
            margin: 0;
        }
    </style>
</head>
<body style="height:100%;">
   <canvas id="canvas" style="height:100%;">
       您的浏览器不支持canvas元素。
   </canvas>
   <script>
       var numMatrix = [
    [
            [0,0,1,1,1,0,0],
            [0,1,1,0,1,1,0],
            [1,1,0,0,0,1,1],
            [1,1,0,0,0,1,1],
            [1,1,0,0,0,1,1],
            [1,1,0,0,0,1,1],
            [1,1,0,0,0,1,1],
            [1,1,0,0,0,1,1],
            [0,1,1,0,1,1,0],
            [0,0,1,1,1,0,0]
    ], //0
    [
            [0,0,0,1,1,0,0],
            [0,1,1,1,1,0,0],
            [0,0,0,1,1,0,0],
            [0,0,0,1,1,0,0],
            [0,0,0,1,1,0,0],
            [0,0,0,1,1,0,0],
            [0,0,0,1,1,0,0],
            [0,0,0,1,1,0,0],
            [0,0,0,1,1,0,0],
            [1,1,1,1,1,1,1]
    ], //1
    [
            [0,1,1,1,1,1,0],
            [1,1,0,0,0,1,1],
            [0,0,0,0,0,1,1],
            [0,0,0,0,1,1,0],
            [0,0,0,1,1,0,0],
            [0,0,1,1,0,0,0],
            [0,1,1,0,0,0,0],
            [1,1,0,0,0,0,0],
            [1,1,0,0,0,1,1],
            [1,1,1,1,1,1,1]
    ], //2
    [
            [1,1,1,1,1,1,1],
            [0,0,0,0,0,1,1],
            [0,0,0,0,1,1,0],
            [0,0,0,1,1,0,0],
            [0,0,1,1,1,0,0],
            [0,0,0,0,1,1,0],
            [0,0,0,0,0,1,1],
            [0,0,0,0,0,1,1],
            [1,1,0,0,0,1,1],
            [0,1,1,1,1,1,0]
    ], //3
    [
            [0,0,0,0,1,1,0],
            [0,0,0,1,1,1,0],
            [0,0,1,1,1,1,0],
            [0,1,1,0,1,1,0],
            [1,1,0,0,1,1,0],
            [1,1,1,1,1,1,1],
            [0,0,0,0,1,1,0],
            [0,0,0,0,1,1,0],
            [0,0,0,0,1,1,0],
            [0,0,0,1,1,1,1]
    ], //4
    [
            [1,1,1,1,1,1,1],
            [1,1,0,0,0,0,0],
            [1,1,0,0,0,0,0],
            [1,1,1,1,1,1,0],
            [0,0,0,0,0,1,1],
            [0,0,0,0,0,1,1],
            [0,0,0,0,0,1,1],
            [0,0,0,0,0,1,1],
            [1,1,0,0,0,1,1],
            [0,1,1,1,1,1,0]
    ], //5
    [
            [0,0,0,0,1,1,0],
            [0,0,1,1,0,0,0],
            [0,1,1,0,0,0,0],
            [1,1,0,0,0,0,0],
            [1,1,0,1,1,1,0],
            [1,1,0,0,0,1,1],
            [1,1,0,0,0,1,1],
            [1,1,0,0,0,1,1],
            [1,1,0,0,0,1,1],
            [0,1,1,1,1,1,0]
    ], //6
    [
            [1,1,1,1,1,1,1],
            [1,1,0,0,0,1,1],
            [0,0,0,0,1,1,0],
            [0,0,0,0,1,1,0],
            [0,0,0,1,1,0,0],
            [0,0,0,1,1,0,0],
            [0,0,1,1,0,0,0],
            [0,0,1,1,0,0,0],
            [0,0,1,1,0,0,0],
            [0,0,1,1,0,0,0]
    ], //7
    [
            [0,1,1,1,1,1,0],
            [1,1,0,0,0,1,1],
            [1,1,0,0,0,1,1],
            [1,1,0,0,0,1,1],
            [0,1,1,1,1,1,0],
            [1,1,0,0,0,1,1],
            [1,1,0,0,0,1,1],
            [1,1,0,0,0,1,1],
            [1,1,0,0,0,1,1],
            [0,1,1,1,1,1,0]   
    ], //8
    [
            [0,1,1,1,1,1,0],
            [1,1,0,0,0,1,1],
            [1,1,0,0,0,1,1],
            [1,1,0,0,0,1,1],
            [0,1,1,1,0,1,1],
            [0,0,0,0,0,1,1],
            [0,0,0,0,0,1,1],
            [0,0,0,0,1,1,0],
            [0,0,0,1,1,0,0],
            [0,1,1,0,0,0,0]
    ], //9
    [
            [0,0,0,0],
            [0,0,0,0],
            [0,1,1,0],
            [0,1,1,0],
            [0,0,0,0],
            [0,0,0,0],
            [0,1,1,0],
            [0,1,1,0],
            [0,0,0,0],
            [0,0,0,0]
    ] //冒号矩阵
];

var WINDOW_WIDTH = document.body.clientWidth || 375;
var WINDOW_HEIGHT = 200;
var RADIUS = 8;
var MARGIN_TOP = 60;
var MARGIN_LEFT = 10;

//定义截止时间
var dayTime = 0;

var curShowTimeSeconds = 0;

var balls = [];
const colors=["#33B5E5","#0099CC","#AA66CC","#9933CC","#99CC00","#669900","#FFBB33","#FF8800","#FF4444","#CC0000"];

window.onload = function() {
    
//    WINDOW_WIDTH = document.body.clientWidth;
//    WINDOW_HEIGHT = document.body.clientHeight;
    
    // MARGIN_LEFT = Math.round(WINDOW_WIDTH / 100);
    MARGIN_TOP = Math.round(WINDOW_HEIGHT / 2);
    
    RADIUS = Math.round(WINDOW_WIDTH * 4 /5 /108) - 1;
    
    var canvas = document.getElementById("canvas");
    var context = canvas.getContext("2d");
    canvas.width = WINDOW_WIDTH;
    canvas.height = WINDOW_HEIGHT;
    
    curShowTimeSeconds = getCurrentShowTimeSeconds();
    console.log(curShowTimeSeconds);
    setInterval(function(){
        render(context);
        update(context);
    },50);   
};
//返回以秒数表示的当前时间
function getCurrentShowTimeSeconds() {
    var curTime = new Date();
    var oldTime = new Date('2017/10/25 20:00:00');
    var ret = curTime.getTime() - oldTime.getTime();
//    var ret = curTime.getHours()*3600+curTime.getMinutes()*60+curTime.getSeconds();
    return ret >= 0? ret : 0;
//    return ret;
}
//更新操作
function update(context) {
    var nextShowTimeSeconds = getCurrentShowTimeSeconds();

    var nextDays = parseInt(nextShowTimeSeconds / (1000 * 60 * 60 * 24));

    var nextHours = parseInt((nextShowTimeSeconds % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
    var nextMinutes = parseInt((nextShowTimeSeconds % (1000 * 60 * 60)) / (1000 * 60));
    var nextSeconds = (nextShowTimeSeconds % (1000 * 60)) / 1000;

    var curHours = parseInt((curShowTimeSeconds % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
    var curMinutes = parseInt((curShowTimeSeconds % (1000 * 60 * 60)) / (1000 * 60));
    var curSeconds = (curShowTimeSeconds % (1000 * 60)) / 1000;
    
    console.log(curShowTimeSeconds,nextShowTimeSeconds,nextSeconds,curSeconds);
    if(nextSeconds != curSeconds) {
        context.font = 'bold 36px Microsoft YaHei,Helvetica,Helvetica Neue,Tahoma,Arial,sans-serif';
        context.fillText(nextDays,10,66);
        
        if(parseInt(curHours/10) != parseInt(nextHours/10)) {
            addBalls(MARGIN_LEFT+0,MARGIN_TOP,parseInt(curHours/10));
        }
        if(parseInt(curHours%10) != parseInt(nextHours%10)) {
            addBalls(MARGIN_LEFT+15*(RADIUS+1),MARGIN_TOP,parseInt(curHours%10));
        }
        if(parseInt(curMinutes/10) != parseInt(nextMinutes/10)) {
            addBalls(MARGIN_LEFT+39*(RADIUS+1),MARGIN_TOP,parseInt(curMinutes/10));
        }
        if(parseInt(curMinutes%10) != parseInt(nextMinutes%10)) {
            addBalls(MARGIN_LEFT+54*(RADIUS+1),MARGIN_TOP,parseInt(curMinutes%10));
        }
        if(parseInt(curSeconds/10) != parseInt(nextSeconds/10)) {
            addBalls(MARGIN_LEFT+78*(RADIUS+1),MARGIN_TOP,parseInt(curSeconds/10));
        }
        if(parseInt(curSeconds%10) != parseInt(nextSeconds%10)) {
            addBalls(MARGIN_LEFT+93*(RADIUS+1),MARGIN_TOP,parseInt(curSeconds%10));
        }
        curShowTimeSeconds = nextShowTimeSeconds;
    }
    updateBalls(); //对所有已经存在的小球的状态进行更新
    // console.log(balls.length);
}
//对所有已经存在的小球的状态进行更新
function updateBalls() {
    for(var i = 0;i < balls.length;i++) {
        
        balls[i].x += balls[i].vx;
        balls[i].y += balls[i].vy;
        balls[i].vy +=  balls[i].g;
        
        if(balls[i].y >= WINDOW_HEIGHT - RADIUS) {
            balls[i].y = WINDOW_HEIGHT - RADIUS;
            balls[i].vy = -Math.abs(balls[i].vy)*0.75;
        }
    }
    var cnt = 0;
    for(var i = 0;i < balls.length;i++) {
        //小球的右边缘大于0并且左边缘小于画面的宽度
        if(balls[i].x+RADIUS > 0 && balls[i].x -RADIUS < WINDOW_WIDTH){
            balls[cnt++] = balls[i];
        }
    }
    while(balls.length > Math.min(300,cnt)) {
        balls.pop();
    }
    
}
//添加小球
function addBalls(x,y,num) {
    for(var i = 0;i < numMatrix[num].length;i++){
        for(var j = 0;j < numMatrix[num][i].length;j++) {
            if(numMatrix[num][i][j] === 1){
                var aBall = {
                    x : x + j*2*(RADIUS+1)+(RADIUS+1),
                    y : y + i*2*(RADIUS+1)+(RADIUS+1),
                    g : 1.5 + Math.random(),
                    vx : Math.pow(-1,Math.ceil(Math.random()*1000))*4,
                    vy: -5,
                    color : colors[Math.floor(Math.random()*colors.length)]
                };
                balls.push(aBall);
            }
        }
    }
}
//绘制当前时间
function render(context) {
    context.clearRect(0,0,WINDOW_WIDTH,WINDOW_HEIGHT);
    context.font = '16px Microsoft YaHei,Helvetica,Helvetica Neue,Tahoma,Arial,sans-serif';
    var hours = parseInt((curShowTimeSeconds % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
    var minutes = parseInt((curShowTimeSeconds  % (1000 * 60 * 60)) / (1000 * 60));
    var seconds = (curShowTimeSeconds % (1000 * 60)) / 1000;
    
    renderMatrix(MARGIN_LEFT, MARGIN_TOP, parseInt(hours/10), context); //十位上的数字
    renderMatrix(MARGIN_LEFT + (7 * 2 +1 )*(RADIUS+1),MARGIN_TOP,parseInt(hours % 10),context); //个位上的数字
    
    // renderMatrix(MARGIN_LEFT + 30*(RADIUS+1),MARGIN_TOP,10,context); //冒号
    context.fillText('小时',MARGIN_LEFT + 30*(RADIUS+1),160);
    
    renderMatrix(MARGIN_LEFT + (33 + (4 * 2 + 1))*(RADIUS+1),MARGIN_TOP,parseInt(minutes / 10),context); //十位上的数
    renderMatrix(MARGIN_LEFT + 57*(RADIUS+1),MARGIN_TOP,parseInt(minutes % 10),context); //个位上的数
    
    // renderMatrix(MARGIN_LEFT + 69*(RADIUS+1),MARGIN_TOP,10,context); //冒号
    context.fillText('分',MARGIN_LEFT + 72.5*(RADIUS+1),160);
    
    renderMatrix(MARGIN_LEFT + (70 + (4 * 2 + 1))*(RADIUS+1),MARGIN_TOP,parseInt(seconds / 10),context); //十位上的数
    renderMatrix(MARGIN_LEFT + 94 * (RADIUS+1),MARGIN_TOP,parseInt(seconds % 10),context); //个位上的数

    context.fillText('秒',MARGIN_LEFT + 109.5*(RADIUS+1),160);
    
    for(var i = 0;i < balls.length;i++) {
        
        context.fillStyle = balls[i].color;
        context.beginPath();
        context.arc(balls[i].x,balls[i].y,RADIUS,0,2*Math.PI,false);
        context.closePath();
        
        context.fill();
    }
}
//绘制小球
function renderMatrix(x,y,num,context) {
    context.fillStyle = "rgb(0,102,153)";
    for(var i = 0;i < numMatrix[num].length;i++) { //每一个数字矩阵的行
        for(var j = 0;j < numMatrix[num][i].length;j++) {
            if(numMatrix[num][i][j] == 1){
                context.beginPath();
                context.arc(x+j*2*(RADIUS+1)+(RADIUS+1),y+i*2*(RADIUS+1)+(RADIUS+1),RADIUS,0,2*Math.PI,false);
                context.closePath();
                context.fill();
            }
        }
    }
}
   </script> 
</body>
</html>
